<%- include ../header %>
    <h3><%= section.title %></h3>

    <h6>Previous Years:
        <select id="previousYear" onchange="switchModel()">
            <option id="tooltip" selected disabled>Choose Here</option>
            <% previousYears.forEach(function(p) { %>
                <% if (p.year !== parseInt(getYear)) { %>
                <option value="<%= p.year %>"><%= p.year %></option>
                <% } %>
            <% }); %>
        </select>
        <button id="import" onclick="setData()">Import</button>
    </h6>

    <div id="docPreview2" style="display:none">
        <% section.body.forEach(function(w) { %>
            <%- include(type(w.type), {w: w, prev: '~prev'}) %>
        <% }); %>
        <br>
        <br>
    </div>

    <form action="/sections/<%=toRoute(section.title)%>/year/<%= getYear %>" method="post">

        <% section.body.forEach(function(w) { %>
            <%- include(type(w.type), {w: w, prev: ''}) %>
        <% }); %>

        <input type="submit" value="submit">
    </form>
<%- include ./oldFooter %>

<script>
    function switchModel() {
        var x = document.getElementById("previousYear").value;
        var previousYears = JSON.parse(JSON.stringify(<%- previousYears2 %>));

        var selectedYear;
        for (var m in previousYears) {
            if (previousYears[m].year === parseInt(x)) {
                selectedYear = previousYears[m];
            }
        }

        delete selectedYear.__v;
        delete selectedYear.year;
        delete selectedYear.username;
        delete selectedYear._id;

        var display = document.getElementById("docPreview2");

        for (var key in selectedYear) {
            var element = document.getElementById(key + '~prev');
            element.disabled = true;

            if (element.type === "text") {
                element.value = selectedYear[key];
            } else if (element.type === "checkbox") {
                element.checked = selectedYear[key];
            } else if (element.type === "select-one") {
                element.value = selectedYear[key];
            } else if (element.type === "month") {
                element.value = selectedYear[key];
            } else if (element.type === "number") {
                element.value = selectedYear[key];
            } else if (element.type === "textarea") {
                CKEDITOR.instances[key + '~prev'].setData(selectedYear[key]);
            }
        }

        return display.style.display = 'inline';
    }

    function setData() {
        var prev = document.getElementsByName("~prev");

        for (var k=0; k < prev.length; k++) {
            var id = prev[k].id.split('~')[0];
            var element = document.getElementById(id);

            if (element.type === "text") {
                element.value = prev[k].value;
            } else if (element.type === "checkbox") {
                element.checked = prev[k].checked;
            } else if (element.type === "select-one") {
                element.value = prev[k].value;
            } else if (element.type === "month") {
                element.value = prev[k].value;
            } else if (element.type === "number") {
                element.value = prev[k].value;
            } else if (element.type === "textarea") {
                CKEDITOR.instances[id].setData(
                        CKEDITOR.instances[prev[k].id].getData()
                );
            }
        }

        document.getElementById('tooltip').selected = true;

        return document.getElementById("docPreview2").style.display = 'none';
    }

    (function() {
        var previousYears = JSON.parse(JSON.stringify(<%- previousYears2 %>));

        if (previousYears.length === 0 ||
                (previousYears.length < 2 && previousYears[0].year === <%= parseInt(getYear) %>) ||
                <%= disablePrevious || false %>) {
            document.getElementById("previousYear").disabled = true;
            document.getElementById("import").disabled = true;
        }
    }())
</script>